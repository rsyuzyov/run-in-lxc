# Alertmanager Configuration Example
# –†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–π –ø—Ä–∏–º–µ—Ä –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

global:
  # –í—Ä–µ–º—è –æ–∂–∏–¥–∞–Ω–∏—è –ø–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π resolved —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
  resolve_timeout: 5m

  # SMTP –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ (–¥–ª—è email —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π)
  smtp_smarthost: 'smtp.example.com:587'
  smtp_from: 'alertmanager@example.com'
  smtp_auth_username: 'alertmanager@example.com'
  smtp_auth_password: 'your-smtp-password'
  smtp_require_tls: true

  # Slack webhook URL (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
  # slack_api_url: 'https://hooks.slack.com/services/T00000000/B00000000/XXXXXXXXXXXXXXXXXXXXXXXX'

# –®–∞–±–ª–æ–Ω—ã —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
templates:
  - '/etc/alertmanager/templates/*.tmpl'

# –ú–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è –∞–ª–µ—Ä—Ç–æ–≤
route:
  # –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –∞–ª–µ—Ä—Ç–æ–≤
  group_by: ['alertname', 'severity', 'instance']
  
  # –í—Ä–µ–º—è –æ–∂–∏–¥–∞–Ω–∏—è –ø–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π –ø–µ—Ä–≤–æ–π –≥—Ä—É–ø–ø—ã
  group_wait: 30s
  
  # –ò–Ω—Ç–µ—Ä–≤–∞–ª –º–µ–∂–¥—É –æ—Ç–ø—Ä–∞–≤–∫–∞–º–∏ –≥—Ä—É–ø–ø—ã
  group_interval: 5m
  
  # –ò–Ω—Ç–µ—Ä–≤–∞–ª –ø–æ–≤—Ç–æ—Ä–Ω–æ–π –æ—Ç–ø—Ä–∞–≤–∫–∏
  repeat_interval: 4h
  
  # –ü–æ–ª—É—á–∞—Ç–µ–ª—å –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
  receiver: 'default'

  # –î–æ—á–µ—Ä–Ω–∏–µ –º–∞—Ä—à—Ä—É—Ç—ã
  routes:
    # –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –∞–ª–µ—Ä—Ç—ã - –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞
    - match:
        severity: critical
      receiver: 'critical'
      group_wait: 10s
      repeat_interval: 1h
      continue: true

    # –ê–ª–µ—Ä—Ç—ã –ø–æ –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–µ
    - match_re:
        alertname: ^(InstanceDown|DiskSpace.*|HighMemory.*|HighCPU.*)$
      receiver: 'infrastructure'
      
    # –ê–ª–µ—Ä—Ç—ã –ø–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è–º
    - match:
        job: blackbox-http
      receiver: 'applications'
      
    # SSL –∞–ª–µ—Ä—Ç—ã
    - match_re:
        alertname: ^SSL.*$
      receiver: 'ssl-alerts'
      repeat_interval: 24h

    # Proxmox –∞–ª–µ—Ä—Ç—ã
    - match:
        job: proxmox
      receiver: 'proxmox'

# –ü–æ–ª—É—á–∞—Ç–µ–ª–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
receivers:
  #############################################
  # Default receiver
  #############################################
  - name: 'default'
    # –ü—Ä–æ—Å—Ç–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ (placeholder)
    
  #############################################
  # Critical alerts - –≤—Å–µ –∫–∞–Ω–∞–ª—ã
  #############################################
  - name: 'critical'
    email_configs:
      - to: 'oncall@example.com'
        send_resolved: true
        headers:
          Subject: 'üî¥ CRITICAL: {{ .GroupLabels.alertname }}'
    
    # Telegram
    telegram_configs:
      - bot_token: '123456789:ABCdefGHIjklMNOpqrsTUVwxyz'
        chat_id: -1001234567890
        send_resolved: true
        message: |
          üî¥ *CRITICAL ALERT*
          
          *Alert:* {{ .GroupLabels.alertname }}
          *Instance:* {{ .CommonLabels.instance }}
          *Severity:* {{ .CommonLabels.severity }}
          
          {{ range .Alerts }}
          *Description:* {{ .Annotations.description }}
          {{ end }}
    
    # Webhook (–¥–ª—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å –¥—Ä—É–≥–∏–º–∏ —Å–∏—Å—Ç–µ–º–∞–º–∏)
    webhook_configs:
      - url: 'http://alertmanager-webhook:5001/critical'
        send_resolved: true

  #############################################
  # Infrastructure alerts
  #############################################
  - name: 'infrastructure'
    email_configs:
      - to: 'infra-team@example.com'
        send_resolved: true
        headers:
          Subject: '‚ö†Ô∏è Infrastructure: {{ .GroupLabels.alertname }}'
    
    telegram_configs:
      - bot_token: '123456789:ABCdefGHIjklMNOpqrsTUVwxyz'
        chat_id: -1001234567891  # –û—Ç–¥–µ–ª—å–Ω—ã–π —á–∞—Ç –¥–ª—è –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã
        send_resolved: true

  #############################################
  # Application alerts (HTTP checks)
  #############################################
  - name: 'applications'
    email_configs:
      - to: 'dev-team@example.com'
        send_resolved: true
    
    # Slack
    # slack_configs:
    #   - channel: '#alerts-apps'
    #     send_resolved: true
    #     title: '{{ .GroupLabels.alertname }}'
    #     text: '{{ .CommonAnnotations.description }}'

  #############################################
  # SSL certificate alerts
  #############################################
  - name: 'ssl-alerts'
    email_configs:
      - to: 'security@example.com'
        send_resolved: true
        headers:
          Subject: 'üîê SSL Certificate: {{ .GroupLabels.alertname }}'

  #############################################
  # Proxmox alerts
  #############################################
  - name: 'proxmox'
    email_configs:
      - to: 'infra-team@example.com'
        send_resolved: true
        headers:
          Subject: 'üñ•Ô∏è Proxmox: {{ .GroupLabels.alertname }}'

# –ü—Ä–∞–≤–∏–ª–∞ –ø–æ–¥–∞–≤–ª–µ–Ω–∏—è (inhibition)
inhibit_rules:
  # –ü–æ–¥–∞–≤–∏—Ç—å warning –µ—Å–ª–∏ –µ—Å—Ç—å critical –¥–ª—è —Ç–æ–≥–æ –∂–µ alertname/instance
  - source_match:
      severity: 'critical'
    target_match:
      severity: 'warning'
    equal: ['alertname', 'instance']
  
  # –ü–æ–¥–∞–≤–∏—Ç—å –≤—Å–µ –∞–ª–µ—Ä—Ç—ã –µ—Å–ª–∏ —Ö–æ—Å—Ç –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω
  - source_match:
      alertname: 'InstanceDown'
    target_match_re:
      alertname: '.+'
    equal: ['instance']

# –í—Ä–µ–º—è —Ç–∏—à–∏–Ω—ã (silences) –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞—é—Ç—Å—è —á–µ—Ä–µ–∑ UI –∏–ª–∏ amtool

