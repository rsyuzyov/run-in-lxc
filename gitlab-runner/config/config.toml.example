# Пример конфигурации GitLab Runner
#
# Расположение: /etc/gitlab-runner/config.toml
# Документация: https://docs.gitlab.com/runner/configuration/advanced-configuration.html
#
# После изменения конфигурации выполните:
#   sudo systemctl restart gitlab-runner

# Количество параллельных задач (для всех Runner'ов)
concurrent = 4

# Интервал проверки новых задач (0 = использовать значение по умолчанию)
check_interval = 0

# Уровень логирования: debug, info, warn, error, fatal, panic
log_level = "info"

# Формат логов: runner, text, json
log_format = "text"

# Настройки сессии (для интерактивных терминалов)
[session_server]
  session_timeout = 1800

##############################################
# Пример: Shell executor
##############################################

[[runners]]
  name = "Shell Runner"
  url = "https://gitlab.example.com"
  token = "RUNNER_TOKEN"
  executor = "shell"
  
  # Ограничения
  limit = 0  # 0 = без ограничений
  
  # Выполнять задачи без тегов
  run_untagged = true
  
  # Привязка к проекту
  locked = false
  
  # Переменные окружения
  environment = ["ENV=production"]
  
  # Рабочая директория
  builds_dir = "/home/gitlab-runner/builds"
  cache_dir = "/home/gitlab-runner/cache"

##############################################
# Пример: Docker executor
##############################################

# [[runners]]
#   name = "Docker Runner"
#   url = "https://gitlab.example.com"
#   token = "RUNNER_TOKEN"
#   executor = "docker"
#   
#   [runners.docker]
#     # Образ по умолчанию
#     image = "alpine:latest"
#     
#     # Привилегированный режим (для Docker-in-Docker)
#     privileged = false
#     
#     # Volumes
#     volumes = ["/cache", "/var/run/docker.sock:/var/run/docker.sock"]
#     
#     # Отключить entrypoint
#     disable_entrypoint_overwrite = false
#     
#     # OOM killer
#     oom_kill_disable = false
#     
#     # Размер /dev/shm
#     shm_size = 0
#     
#     # Pull policy: always, if-not-present, never
#     pull_policy = "if-not-present"
#     
#     # Сеть
#     network_mode = "bridge"
#     
#     # DNS
#     dns = ["8.8.8.8"]
#     
#     # Extra hosts
#     extra_hosts = ["gitlab.example.com:192.168.1.10"]
#     
#     # Allowed images (glob patterns)
#     allowed_images = ["*"]
#     
#     # Allowed services
#     allowed_services = ["*"]

##############################################
# Пример: Docker executor с Docker-in-Docker
##############################################

# [[runners]]
#   name = "DinD Runner"
#   url = "https://gitlab.example.com"
#   token = "RUNNER_TOKEN"
#   executor = "docker"
#   
#   [runners.docker]
#     image = "docker:latest"
#     privileged = true
#     volumes = ["/cache", "/certs/client"]
#     
#     # Для Docker-in-Docker
#     services_privileged = true

##############################################
# Кэширование
##############################################

# Локальный кэш
# [[runners]]
#   [runners.cache]
#     Type = "local"
#     Path = "/cache"
#     Shared = false

# S3-совместимый кэш
# [[runners]]
#   [runners.cache]
#     Type = "s3"
#     Shared = true
#     
#     [runners.cache.s3]
#       ServerAddress = "s3.example.com"
#       AccessKey = "access_key"
#       SecretKey = "secret_key"
#       BucketName = "gitlab-runner-cache"
#       BucketLocation = "us-east-1"
#       Insecure = false

# GCS кэш
# [[runners]]
#   [runners.cache]
#     Type = "gcs"
#     Shared = true
#     
#     [runners.cache.gcs]
#       BucketName = "gitlab-runner-cache"
#       CredentialsFile = "/path/to/credentials.json"

##############################################
# Пример: Несколько Runner'ов
##############################################

# Runner для сборки
# [[runners]]
#   name = "Build Runner"
#   url = "https://gitlab.example.com"
#   token = "BUILD_RUNNER_TOKEN"
#   executor = "docker"
#   limit = 2
#   
#   [runners.docker]
#     image = "node:18"
#     privileged = false
#     volumes = ["/cache"]

# Runner для деплоя
# [[runners]]
#   name = "Deploy Runner"
#   url = "https://gitlab.example.com"
#   token = "DEPLOY_RUNNER_TOKEN"
#   executor = "shell"
#   limit = 1
#   locked = true

##############################################
# Дополнительные настройки
##############################################

# Таймауты для задач
# [[runners]]
#   output_limit = 4096  # KB, размер лога
#   
#   [runners.custom_build_dir]
#     enabled = true

# Переменные окружения для всех задач
# [[runners]]
#   pre_clone_script = "echo 'Pre-clone script'"
#   pre_build_script = "echo 'Pre-build script'"
#   post_build_script = "echo 'Post-build script'"

